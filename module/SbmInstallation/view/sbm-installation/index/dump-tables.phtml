<?php
/**
 * Page de sauvegarde des données
 *
 * Choix des tables à sauvegarder et affichage du compte-rendu.
 * 
 * @project sbm
 * @package SbmInstallation/view/sbm-installation/index
 * @filesource dump-tables.phtml
 * @encodage UTF-8
 * @author DAFAP Informatique - Alain Pomirol (dafap@free.fr)
 * @date 24 fév. 2019
 * @version 2019-2.5.0
 */
$this->headLink()->appendStylesheet($this->basePath('css/fam-icons-custom.css'));
$this->jQuery();
$this->headScript()->appendFile($this->basePath('js/checkallbox.js'));
$this->inlineScript()->captureStart();
?>
multicheckbox_actions.init('tables');
<?php
$this->inlineScript()->captureEnd();
$retour = $this->url("sbminstall");
$actions = [
    'retour' => [
        'class' => 'fam-door-out',
        'formaction' => $retour,
        'title' => 'Retour'
    ]
];

// pour afficher le résultat, il faut conserver la balise <pre> et échapper le texte à l'intérieur
preg_match('/^<pre>(.*)<\/pre>\z/si', $this->description, $inner);
if (! empty($inner)) {
    $escaper = new \Zend\Escaper\Escaper('utf-8');
    $output = '<pre>' . $escaper->escapeHtmlAttr($inner[1]) . '</pre>';
} else {
    $output = $this->description;
}
?>
<h1><?= $this->titre; ?></h1>
<div id="data-wrapper">
	<div id="data-header">
		<div class="menu clearfix"><?= $this->listeZoneActions([], $actions)?></div>
	</div>
	<div id="data-inner">
		<p><?= $output; ?></p>
<?php if (is_null($this->form)) : ?>
        <pre>
  <?php
    // liste des tables copiées
    ob_start();
    var_dump($this->tables);
    echo strip_tags(ob_get_clean());
    ?>
        </pre>
		<a href="<?= $retour; ?>" class="bouton" title="Retour"><i
			class="fam-door-out"></i></a>
<?php else : ?>
  <?php
    // formulaire
    $this->form->prepare();
    $this->form->setAttribute('action',
        $this->url('sbminstall', [
            'action' => 'dump-tables'
        ]));

    echo $this->form()->openTag($this->form);

    $element = $this->form->get('tables');
    ?>
    <div id='tables'><?= $this->formRow($element);?></div>
    <?php $element = $this->form->get('systems');?>
    <div id='systems'><?= $this->formRow($element);?></div>
    <?php $element = $this->form->get('plugin');?> 
    <div><?= $this->formRow($element);?></div>
    <?php
    $element = $this->form->get('onscreen');
    $element->setValue(0);
    echo $this->formRow($element);
    echo $this->formElement($this->form->get('cancel'));
    echo $this->formElement($this->form->get('copy'));

    echo $this->form()->closeTag();
    ?> 
<?php endif; ?>
    </div>
	<div id="data-footer"></div>
</div>